import re, os, time
file = open("ttp_from_stacktrace_per_line_new.txt", "r")
output = open("performance_output_batch", "w")
lines = file.readlines()

for line in lines:
    line = line.strip()
    pattern = r'\{.*\}'
    match = re.search(pattern, line)
    
    if match:
        content = eval(match.group(0))
        if len(content) < 1:
            print("len is 0")
            continue
    else:
        continue
    

    pattern = r'\S+\.txt'
    match = re.search(pattern, line)
    if match:
        filename = match.group(0)[:-4]
        #print("sh host_patch.sh ../malware_sample_without_packer/{0} output_folder".format(filename))
        start_time = time.time()
        os.system("sh host_patch.sh ../malware_sample_without_packer/{0} output_folder".format(filename))
        end_time = time.time()
        print(filename + " takes " + str(end_time - start_time) + " seconds", file=output)
    else:
        print("error on " + line)
