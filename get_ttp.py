import angr
import json
import sys
import re


ttps = []

def add_stat(content):
    if list(content.keys()):
        ttps.append(list(content.keys())[0])

def recr_json(data):
    if isinstance(data, dict):  # If the current object is a dictionary
        for key, value in data.items():
            if key == 'ttp':
                add_stat(data[key])  # Modify the content if the key is found
            else:
                recr_json(value)  # Recurse into the value
    elif isinstance(data, list):  # If the current object is a list
        for item in data:
            recr_json(item)  # Recurse into each item




if __name__ == "__main__":
    path_pfx = '/home/junyu33/.cuckoo/storage/analyses'
    for i in range(1, 56):
        print('Processing ' + str(i))
        filename = path_pfx + '/' + str(i) + '/reports/report.json'
        with open(filename, 'r') as file:
            data = json.load(file)
            recr_json(data)

    # sort ttps by frequency
    # print(ttps)
    ttps.sort()
    ttps_freq = {}
    for ttp in ttps:
        if ttp in ttps_freq:
            ttps_freq[ttp] += 1
        else:
            ttps_freq[ttp] = 1

    ttps_freq = dict(sorted(ttps_freq.items(), key=lambda item: item[1], reverse=True))
    print(ttps_freq)


