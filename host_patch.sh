#!/bin/sh
# host_patch.sh <input> <output_folder>
if [ "$#" -ne 2 ]; then
    echo "Usage: host_patch.sh <input> <output_folder>"
    exit 1
fi
filename=$(basename $1)
echo "---------python3 patch.sh $1---------"
python3 patch.py $1
echo "---------running host_get_stacktrace.sh-----------"
folder=../malware_sample_without_packer

#echo "---------running host_get_stacktrace.sh $1.patched $2/patch1.txt---------"
#sh host_get_stacktrace.sh "$1.patched" "$2/$filename.patch.txt"
#echo "---------running host_get_stacktrace.sh $1.patched1 $2/patch2.txt---------"
#sh host_get_stacktrace.sh "$1.patched1" "$2/$filename.patch1.txt"
for file in $folder/*; do
  if [[ $file == *"$1.patched"* ]]; then
    basename=$(basename $file)
    echo "sh host_get_stacktrace.sh '$file' '$2/$basename.txt'"
    sh host_get_stacktrace.sh $file $2/$basename.txt
  fi
done


echo "---------running post_evaluate.py----------"
#python3 post_evaluate.py $2/$filename.patch.txt > $2/$filename.patch.out
#python3 post_evaluate.py $2/$filename.patch1.txt > $2/$filename.patch1.out
for file in $folder/*; do
  if [[ $file == *"$1.patched"* ]]; then
    basename=$(basename $file)
    echo "python3 post_evaluate.py $file > $2/$basename.out"
    python3 post_evaluate.py $file > $2/$basename.out
  fi
done

