import os

api2ttp = eval(open('inv_mapping').read())

result_file = 'ttp_from_stacktrace_per_line.txt'
result = open(result_file, 'w')

def analyze(filename):
    with open(filename, encoding='utf-8', errors='ignore') as f:
        found_ttps = set()
        for line in f:
            for api in api2ttp:
                if api in line:
                    for ttp in api2ttp[api]:
                        found_ttps.add(ttp)
        result.write(str(found_ttps) + '\n')

for filename in os.listdir('stktrace_output'):
    print(filename)
    analyze('stktrace_output/' + filename)
